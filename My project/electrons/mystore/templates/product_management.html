{% if request.session.role == 'admin' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 
<style>
  body {
    font-family: "Poppins", sans-serif;
    background-color: #f8f9fa;
    display: flex;
    margin: 0;
  }

    /* Sidebar */
    .sidebar {
      height: 100vh;
      background: #f8f9fa;
      border-right: 1px solid #e0e0e0;
      padding-top: 30px;
      position: fixed;
      width: 250px;
      transition: all 0.3s ease;
    }

    .sidebar a {
      display: block;
      padding: 12px 20px;
      color: #333;
      font-weight: 500;
      text-decoration: none;
      transition: 0.3s;
    }

    .sidebar a:hover {
      background: #007bff;
      color: white;
      border-radius: 8px;
      transform: scale(1.02);
    }

  /* Main content beside sidebar */
  .main-content {
    margin-left: 240px;
    padding: 30px;
    flex: 1;
  }

  hr {
    border: none;
    border-top: 1px solid #ddd;
    margin: 15px 0;
  }
  
</style>

<body>
    <!-- Sidebar -->

  <!-- Sidebar -->
  <div class="sidebar">
    <h4 class="text-center fw-bold mb-4 text-primary">ELECTRON</h4>
    <a href="/">Home</a>
    <a href="/admin_dashboard">Dashboard</a>
    <a href="/user_management">User Management</a>
    <a href="/product_management">Product Management</a>
    <a href="/admin_orders">Orders</a>
    <a href="/ticket">Tickets</a>
    <hr>
    <a href="#">Settings</a>
    <a href="/logout" class="text-danger">Logout</a>
  </div>
   


<div class="main-content">
  <div class="container-fluid">
    <h2 class="mb-4 text-primary">Product Management</h2>
    <div class="text-end mb-3">
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addProductModal">➕ Add Product</button>
    </div>
    <table class="table table-hover table-bordered align-middle">
      <thead class="table-primary text-center">
        <tr>
          <th>ID</th>
          <th>Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td>{{ product.id }}</td>
          <td class="text-center" style="align-items: center;">
            {% if product.product_image %}
                <img src="{{ product.product_image.url }}" alt="{{ product.product_name }}" width="auto" height="70" class="rounded shadow-sm">
            {% else %}
                <span class="text-muted">No image</span>
            {% endif %}
            </td>
          <td>{{ product.product_name }}</td>
          <td>₹{{ product.product_price }}</td>
          <td>{{ product.product_stock }}</td>
          <td class="text-center">
            <a href="" class="btn btn-warning btn-sm">Edit</a>
            <a href="" class="btn btn-danger btn-sm"
               onclick="return confirm('Are you sure you want to delete this product?')">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<!--  add product modal  -->

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl"> <!-- full-width large modal -->
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="addProductLabel">Add New Product</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

    <form id="addProductForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-body">
          <div class="container">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Product Name</label>
                <input type="text" class="form-control" name="product_name" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Price</label>
                <input type="number" class="form-control" name="product_price" required>
              </div>

              <div class="col-md-6">
                <label class="form-label">Stock Quantity</label>
                <input type="number" class="form-control" name="product_stock" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Category</label>
                <input type="text" class="form-control" name="product_category">
              </div>

              <div class="col-12">
                <label class="form-label">Description</label>
                <textarea class="form-control" rows="3" name="product_description"></textarea>
              </div>

              <div class="col-12">
                <label class="form-label">Product Image</label>
                <input type="file" class="form-control" name="product_image" accept="image/*" required>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save Product</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {

  // Handle Add Product form submission
  $("#addProductForm").on("submit", function(e) {
    e.preventDefault(); // stop normal form submission

    var formData = new FormData(this);

    $.ajax({
      url: "{% url 'add_product' %}", // Django view URL
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      beforeSend: function() {
        // Optional: Add loading effect
        $(".btn-primary").html("Saving...");
      },
      success: function(response) {
        // Close modal
        $("#addProductModal").modal("hide");

        // Reset form
        $("#addProductForm")[0].reset();
        $(".btn-primary").html("Save Product");

        // Add new product row dynamically with fade-in effect
        let newRow = `
          <tr style="display:none;">
            <td>${response.product_id}</td>
            <td><img src="${response.product_image}" width="70"></td>
            <td>${response.product_name}</td>
            <td>₹${response.product_price}</td>
            <td>${response.product_stock}</td>
            <td class="text-center">
              <a href="/edit_product/${response.product_id}" class="btn btn-warning btn-sm">Edit</a>
              <a href="/delete_product/${response.product_id}" class="btn btn-danger btn-sm">Delete</a>
            </td>
          </tr>
        `;
        $("table tbody").prepend(newRow);
        $("table tbody tr:first").fadeIn(800); // smooth animation
      },
      error: function() {
        alert("❌ Something went wrong while adding the product!");
        $(".btn-primary").html("Save Product");
      }
    });
  });

});
</script>

</body>
</html>
{% else %}
<h1 style="color: red;">Wrong Entrence </h1>

{% endif%}